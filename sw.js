!function(I){var Q={};function g(C){if(Q[C])return Q[C].exports;var F=Q[C]={i:C,l:!1,exports:{}};return I[C].call(F.exports,F,F.exports,g),F.l=!0,F.exports}g.m=I,g.c=Q,g.d=function(I,Q,C){g.o(I,Q)||Object.defineProperty(I,Q,{enumerable:!0,get:C})},g.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},g.t=function(I,Q){if(1&Q&&(I=g(I)),8&Q)return I;if(4&Q&&"object"==typeof I&&I&&I.__esModule)return I;var C=Object.create(null);if(g.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:I}),2&Q&&"string"!=typeof I)for(var F in I)g.d(C,F,function(Q){return I[Q]}.bind(null,F));return C},g.n=function(I){var Q=I&&I.__esModule?function(){return I.default}:function(){return I};return g.d(Q,"a",Q),Q},g.o=function(I,Q){return Object.prototype.hasOwnProperty.call(I,Q)},g.p="",g(g.s=33)}({0:function(module,__webpack_exports__,__webpack_require__){"use strict";eval("/* harmony import */ var _airly_AirlyPull__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3);\n/* harmony import */ var _IndexedDB__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1);\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\nconst airlyStore = { installationInfos: {} };\r\nclass Store {\r\n}\r\nStore.Airly = {\r\n    store: airlyStore,\r\n    installationById(id) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return yield this.installation({ id });\r\n        });\r\n    },\r\n    installation(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (typeof data.id === 'number' || typeof data.id === 'string') {\r\n                const id = parseInt(data.id.toString());\r\n                const info = yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('InstallationInfo').get(id);\r\n                if (typeof info !== 'undefined') {\r\n                    console.info('fast');\r\n                    return info;\r\n                }\r\n            }\r\n            console.info('slow');\r\n            const installationInfo = yield _airly_AirlyPull__WEBPACK_IMPORTED_MODULE_0__[/* AirlyPull */ \"a\"].installation(data);\r\n            this.store.installationInfos[installationInfo.id] = installationInfo;\r\n            yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('InstallationInfo').put(installationInfo);\r\n            return installationInfo;\r\n        });\r\n    },\r\n    measurements(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const id = (yield this.installation(data)).id;\r\n            const measurements = yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('History').measurement.get(id);\r\n            return measurements;\r\n        });\r\n    },\r\n    historyUpdateDateTime(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const id = (yield this.installation(data)).id;\r\n            const mostRecentUpdate = yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('History').updates.getMostRecent(id);\r\n            return mostRecentUpdate;\r\n        });\r\n    }\r\n};\r\nStore.Settings = {\r\n    setting(name, value) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (typeof value === 'undefined') {\r\n                const setting = yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('Settings').global.get(name);\r\n                return setting && setting.value;\r\n            }\r\n            else {\r\n                return yield Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_1__[/* db */ \"a\"])('Settings').global.put({ name, value });\r\n            }\r\n        });\r\n    }\r\n};\r\n/* harmony default export */ __webpack_exports__[\"a\"] = (Store);\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvU3RvcmUudHM/MDg0ZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQWlIO0FBQ2hGO0FBS2pDLE1BQU0sVUFBVSxHQUFlLEVBQUUsaUJBQWlCLEVBQUUsRUFBRSxFQUFFO0FBQ3hELE1BQU0sS0FBSzs7QUFDQSxXQUFLLEdBQUc7SUFDWCxLQUFLLEVBQUUsVUFBVTtJQUNYLGdCQUFnQixDQUFDLEVBQW1COztZQUN0QyxPQUFPLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0MsQ0FBQztLQUFBO0lBQ0ssWUFBWSxDQUFDLElBQTBCOztZQUN6QyxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUUsS0FBSyxRQUFRLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxLQUFLLFFBQVEsRUFBRTtnQkFDNUQsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxJQUFJLEdBQUcsTUFBTSw2REFBRSxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNsRCxJQUFJLE9BQU8sSUFBSSxLQUFLLFdBQVcsRUFBRTtvQkFDN0IsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7b0JBQ3BCLE9BQU8sSUFBSSxDQUFDO2lCQUNmO2FBQ0o7WUFDRCxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNwQixNQUFNLGdCQUFnQixHQUFHLE1BQU0sa0VBQVMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQztZQUNyRSxNQUFNLDZEQUFFLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNuRCxPQUFPLGdCQUFnQixDQUFDO1FBQzVCLENBQUM7S0FBQTtJQUNLLFlBQVksQ0FBQyxJQUEwQjs7WUFDekMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDOUMsTUFBTSxZQUFZLEdBQUcsTUFBTSw2REFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDN0QsT0FBTyxZQUFZLENBQUM7UUFDeEIsQ0FBQztLQUFBO0lBQ0sscUJBQXFCLENBQUMsSUFBMEI7O1lBQ2xELE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQzlDLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSw2REFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkUsT0FBTyxnQkFBZ0IsQ0FBQztRQUM1QixDQUFDO0tBQUE7Q0FDSjtBQUNNLGNBQVEsR0FBRztJQUNSLE9BQU8sQ0FBQyxJQUFZLEVBQUUsS0FBVzs7WUFDbkMsSUFBSSxPQUFPLEtBQUssS0FBSyxXQUFXLEVBQUU7Z0JBQzlCLE1BQU0sT0FBTyxHQUFHLE1BQU0sNkRBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0RCxPQUFPLE9BQU8sSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDO2FBQ25DO2lCQUFNO2dCQUNILE9BQU8sTUFBTSw2REFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQzthQUMzRDtRQUNMLENBQUM7S0FBQTtDQUNKO0FBR1UsOERBQUssRUFBQyIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWlybHlQdWxsLCBJbnN0YWxsYXRpb25Bcmd1bWVudCwgQWlybHlJbnN0YWxsYXRpb25JbmZvLCBBaXJseU1lYXN1cmVtZW50SW5mbyB9IGZyb20gJy4vYWlybHkvQWlybHlQdWxsJztcclxuaW1wb3J0IHsgZGIgfSBmcm9tIFwiLi9JbmRleGVkREJcIjtcclxuaW1wb3J0IHsgdXBkYXRlTWVhc3VyZW1lbnRzIH0gZnJvbSAnLi9haXJseS9BaXJseU1lYXN1cmVtZW50c0dhdGhlcmluZyc7XHJcbmludGVyZmFjZSBBaXJseVN0b3JlIHtcclxuICAgIGluc3RhbGxhdGlvbkluZm9zOiBSZWNvcmQ8bnVtYmVyLCBBaXJseUluc3RhbGxhdGlvbkluZm8+XHJcbn1cclxuY29uc3QgYWlybHlTdG9yZTogQWlybHlTdG9yZSA9IHsgaW5zdGFsbGF0aW9uSW5mb3M6IHt9IH1cclxuY2xhc3MgU3RvcmUge1xyXG4gICAgc3RhdGljIEFpcmx5ID0ge1xyXG4gICAgICAgIHN0b3JlOiBhaXJseVN0b3JlLFxyXG4gICAgICAgIGFzeW5jIGluc3RhbGxhdGlvbkJ5SWQoaWQ6IG51bWJlciB8IHN0cmluZyk6IFByb21pc2U8QWlybHlJbnN0YWxsYXRpb25JbmZvPiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmluc3RhbGxhdGlvbih7IGlkIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXN5bmMgaW5zdGFsbGF0aW9uKGRhdGE6IEluc3RhbGxhdGlvbkFyZ3VtZW50KTogUHJvbWlzZTxBaXJseUluc3RhbGxhdGlvbkluZm8+IHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmlkID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgZGF0YS5pZCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoZGF0YS5pZC50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSBhd2FpdCBkYignSW5zdGFsbGF0aW9uSW5mbycpLmdldChpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGluZm8gIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdmYXN0JylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5mbztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmluZm8oJ3Nsb3cnKVxyXG4gICAgICAgICAgICBjb25zdCBpbnN0YWxsYXRpb25JbmZvID0gYXdhaXQgQWlybHlQdWxsLmluc3RhbGxhdGlvbihkYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5zdG9yZS5pbnN0YWxsYXRpb25JbmZvc1tpbnN0YWxsYXRpb25JbmZvLmlkXSA9IGluc3RhbGxhdGlvbkluZm87XHJcbiAgICAgICAgICAgIGF3YWl0IGRiKCdJbnN0YWxsYXRpb25JbmZvJykucHV0KGluc3RhbGxhdGlvbkluZm8pO1xyXG4gICAgICAgICAgICByZXR1cm4gaW5zdGFsbGF0aW9uSW5mbztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFzeW5jIG1lYXN1cmVtZW50cyhkYXRhOiBJbnN0YWxsYXRpb25Bcmd1bWVudCk6IFByb21pc2U8eyBpbnN0YWxsYXRpb25JZDogbnVtYmVyLCBtZWFzdXJlbWVudDogQWlybHlNZWFzdXJlbWVudEluZm8gfVtdPiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gKGF3YWl0IHRoaXMuaW5zdGFsbGF0aW9uKGRhdGEpKS5pZDtcclxuICAgICAgICAgICAgY29uc3QgbWVhc3VyZW1lbnRzID0gYXdhaXQgZGIoJ0hpc3RvcnknKS5tZWFzdXJlbWVudC5nZXQoaWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gbWVhc3VyZW1lbnRzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXN5bmMgaGlzdG9yeVVwZGF0ZURhdGVUaW1lKGRhdGE6IEluc3RhbGxhdGlvbkFyZ3VtZW50KTogUHJvbWlzZTx7IGluc3RhbGxhdGlvbklkOiBudW1iZXIsIHVwZGF0ZURhdGVUaW1lOiBzdHJpbmcgfT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IChhd2FpdCB0aGlzLmluc3RhbGxhdGlvbihkYXRhKSkuaWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vc3RSZWNlbnRVcGRhdGUgPSBhd2FpdCBkYignSGlzdG9yeScpLnVwZGF0ZXMuZ2V0TW9zdFJlY2VudChpZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBtb3N0UmVjZW50VXBkYXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBTZXR0aW5ncyA9IHtcclxuICAgICAgICBhc3luYyBzZXR0aW5nKG5hbWU6IHN0cmluZywgdmFsdWU/OiBhbnkpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmcgPSBhd2FpdCBkYignU2V0dGluZ3MnKS5nbG9iYWwuZ2V0KG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmcgJiYgc2V0dGluZy52YWx1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBkYignU2V0dGluZ3MnKS5nbG9iYWwucHV0KHsgbmFtZSwgdmFsdWUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFN0b3JlO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},1:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return db; });\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nconst dbInfo = {\r\n    InstallationInfo: {\r\n        version: 1,\r\n        onupgradeneeded(db) {\r\n            const objectStore = db.createObjectStore("installations", { keyPath: "id" });\r\n        },\r\n        methods(getDb) {\r\n            return {\r\n                get(id) {\r\n                    return __awaiter(this, void 0, void 0, function* () {\r\n                        const db = yield getDb();\r\n                        const transaction = db.transaction(["installations"], "readwrite");\r\n                        const objectStore = transaction.objectStore("installations");\r\n                        return new Promise((resolve, reject) => {\r\n                            const req = objectStore.get(id);\r\n                            req.onsuccess = (event) => {\r\n                                resolve(req.result);\r\n                            };\r\n                            req.onerror = (event) => {\r\n                                console.error(event, id);\r\n                                reject(req.result);\r\n                            };\r\n                        });\r\n                    });\r\n                },\r\n                put(data) {\r\n                    return __awaiter(this, void 0, void 0, function* () {\r\n                        const db = yield getDb();\r\n                        const transaction = db.transaction(["installations"], "readwrite");\r\n                        const objectStore = transaction.objectStore("installations");\r\n                        const req = objectStore.add(data);\r\n                        req.oncomplete = (event) => {\r\n                            Promise.resolve(true);\r\n                        };\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    },\r\n    History: {\r\n        version: 2,\r\n        onupgradeneeded(db) {\r\n            if (!db.objectStoreNames.contains(\'measurementHistory\')) {\r\n                const objectStore = db.createObjectStore("measurementHistory", {\r\n                    keyPath: [\r\n                        "installationId",\r\n                        "measurement.fromDateTime",\r\n                        "measurement.tillDateTime"\r\n                    ]\r\n                });\r\n                objectStore.createIndex("installationId", "installationId", { unique: false });\r\n                objectStore.createIndex("fromDateTime", "measurement.fromDateTime", { unique: false });\r\n                objectStore.createIndex("tillDateTime", "measurement.tillDateTime", { unique: false });\r\n            }\r\n            if (!db.objectStoreNames.contains(\'forecastHistory\')) {\r\n                const objectStore = db.createObjectStore("forecastHistory", {\r\n                    keyPath: [\r\n                        "installationId",\r\n                        "predictionDateTime",\r\n                        "measurement.fromDateTime",\r\n                        "measurement.tillDateTime"\r\n                    ]\r\n                });\r\n                objectStore.createIndex("installationId", "installationId");\r\n                objectStore.createIndex("fromDateTime", "measurement.fromDateTime", { unique: false });\r\n                objectStore.createIndex("tillDateTime", "measurement.tillDateTime", { unique: false });\r\n                objectStore.createIndex("predictionDateTime", "predictionDateTime", { unique: false });\r\n            }\r\n            if (!db.objectStoreNames.contains(\'updates\')) {\r\n                const objectStore = db.createObjectStore("updates", {\r\n                    keyPath: [\r\n                        "installationId",\r\n                        "updateDateTime"\r\n                    ]\r\n                });\r\n                objectStore.createIndex("installationId", "installationId", { unique: false });\r\n                objectStore.createIndex("updateDateTime", "updateDateTime", { unique: false });\r\n            }\r\n        },\r\n        methods(getDb) {\r\n            return {\r\n                measurement: {\r\n                    get(installationId) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["measurementHistory"], "readonly");\r\n                            const objectStore = transaction.objectStore("measurementHistory");\r\n                            return new Promise((resolve, reject) => {\r\n                                const fromIndex = objectStore.index(\'installationId\');\r\n                                const keyRange = IDBKeyRange.only(installationId);\r\n                                const req = fromIndex.getAll(keyRange);\r\n                                req.onsuccess = (event) => {\r\n                                    resolve(req.result);\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(event, installationId);\r\n                                    reject(event);\r\n                                };\r\n                            });\r\n                        });\r\n                    },\r\n                    putAll(data) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            console.debug(data);\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["measurementHistory"], "readwrite");\r\n                            const objectStore = transaction.objectStore("measurementHistory");\r\n                            const promises = data.map(record => {\r\n                                return new Promise((resolve, reject) => {\r\n                                    const req = objectStore.put(record);\r\n                                    req.onsuccess = (event) => {\r\n                                        resolve(true);\r\n                                    };\r\n                                    req.onerror = (event) => {\r\n                                        console.error(\'measurement.putAll error\', event, record);\r\n                                        reject();\r\n                                    };\r\n                                });\r\n                            });\r\n                            return yield Promise.all(promises);\r\n                        });\r\n                    }\r\n                },\r\n                forecast: {\r\n                    get(fromPredictionDateTime, tillPredictionDateTime) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["forecastHistory"], "readonly");\r\n                            const objectStore = transaction.objectStore("forecastHistory");\r\n                            return new Promise((resolve, reject) => {\r\n                                const fromIndex = objectStore.index(\'predictionDateTime\');\r\n                                const keyRange = IDBKeyRange.bound(fromPredictionDateTime, tillPredictionDateTime);\r\n                                const req = fromIndex.getAll(keyRange);\r\n                                req.onsuccess = (event) => {\r\n                                    resolve();\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(event, fromPredictionDateTime, tillPredictionDateTime);\r\n                                    reject();\r\n                                };\r\n                            });\r\n                        });\r\n                    },\r\n                    putAll(data) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["forecastHistory"], "readwrite");\r\n                            const objectStore = transaction.objectStore("forecastHistory");\r\n                            const promises = data.map(record => {\r\n                                return new Promise((resolve, reject) => {\r\n                                    const req = objectStore.put(record);\r\n                                    req.onsuccess = (event) => {\r\n                                        resolve(true);\r\n                                    };\r\n                                    req.onerror = (event) => {\r\n                                        console.error(event, data);\r\n                                        reject({\r\n                                            event,\r\n                                            record\r\n                                        });\r\n                                    };\r\n                                });\r\n                            });\r\n                            return Promise.all(promises);\r\n                        });\r\n                    }\r\n                },\r\n                updates: {\r\n                    getMostRecent(installationId) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["updates"], "readonly");\r\n                            const objectStore = transaction.objectStore("updates");\r\n                            return new Promise((resolve, reject) => {\r\n                                const fromIndex = objectStore.index(\'installationId\');\r\n                                const keyRange = IDBKeyRange.only(installationId);\r\n                                const req = fromIndex.getAll(keyRange);\r\n                                req.onsuccess = (event) => {\r\n                                    const theMostRecent = req.result.reduce((mostRecent, current) => {\r\n                                        if (mostRecent.updateDateTime < current.updateDateTime)\r\n                                            return current;\r\n                                        return mostRecent;\r\n                                    }, req.result[0] || {});\r\n                                    resolve(theMostRecent);\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(event, installationId);\r\n                                    reject(event);\r\n                                };\r\n                            });\r\n                        });\r\n                    },\r\n                    put(data) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["updates"], "readwrite");\r\n                            const objectStore = transaction.objectStore("updates");\r\n                            return yield new Promise((resolve, reject) => {\r\n                                const req = objectStore.put(data);\r\n                                req.onsuccess = (event) => {\r\n                                    resolve(true);\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(\'updates.put error\', event, data);\r\n                                    reject();\r\n                                };\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    },\r\n    Settings: {\r\n        version: 1,\r\n        onupgradeneeded(db) {\r\n            if (!db.objectStoreNames.contains(\'global\')) {\r\n                const objectStore = db.createObjectStore("global", { keyPath: "name" });\r\n                objectStore.createIndex("name", "name", { unique: true });\r\n                objectStore.createIndex("value", "value", { unique: false });\r\n            }\r\n        },\r\n        methods(getDb) {\r\n            return {\r\n                global: {\r\n                    get(name) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["global"], "readonly");\r\n                            const objectStore = transaction.objectStore("global");\r\n                            return new Promise((resolve, reject) => {\r\n                                const fromIndex = objectStore.index(\'name\');\r\n                                const keyRange = IDBKeyRange.only(name);\r\n                                const req = fromIndex.get(keyRange);\r\n                                req.onsuccess = (event) => {\r\n                                    resolve(req.result);\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(event);\r\n                                    reject(event);\r\n                                };\r\n                            });\r\n                        });\r\n                    },\r\n                    put(setting) {\r\n                        return __awaiter(this, void 0, void 0, function* () {\r\n                            const db = yield getDb();\r\n                            const transaction = db.transaction(["global"], "readwrite");\r\n                            const objectStore = transaction.objectStore("global");\r\n                            return new Promise((resolve, reject) => {\r\n                                const req = objectStore.put(setting);\r\n                                req.onsuccess = (event) => {\r\n                                    resolve(true);\r\n                                };\r\n                                req.onerror = (event) => {\r\n                                    console.error(\'measurement.putAll error\', event, setting);\r\n                                    reject(event);\r\n                                };\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    }\r\n};\r\nfunction db(name) {\r\n    if (typeof dbInfo[name] === \'undefined\') {\r\n        throw `IndexedDB \'${name}\' is not supported.`;\r\n    }\r\n    const version = dbInfo[name].version;\r\n    function getDb() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const persistent = yield ensureDataPersistance();\r\n            console.debug(\'PERSISTENT\', persistent);\r\n            return yield new Promise((resolve, reject) => {\r\n                const request = indexedDB.open(name, version);\r\n                request.onerror = event => {\r\n                    reject(`IndexedDB error`);\r\n                };\r\n                request.onsuccess = (event) => {\r\n                    const db = event.target.result;\r\n                    resolve(db);\r\n                };\r\n                request.onupgradeneeded = (event) => {\r\n                    const db = event.target.result;\r\n                    dbInfo[name].onupgradeneeded(db);\r\n                    const transaction = event.target.transaction;\r\n                    transaction.oncomplete = (event) => {\r\n                        console.debug(\'upgraded\');\r\n                        resolve(db);\r\n                    };\r\n                    transaction.onerror = (event) => {\r\n                        reject(event);\r\n                    };\r\n                };\r\n            });\r\n        });\r\n    }\r\n    return dbInfo[name].methods(getDb);\r\n}\r\nfunction ensureDataPersistance() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (navigator.storage && navigator.storage.persist) {\r\n            const persistent = yield navigator.storage.persisted();\r\n            return persistent || (yield navigator.storage.persist());\r\n        }\r\n        return false;\r\n    });\r\n}\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvSW5kZXhlZERCLnRzP2MxNjMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsTUFBTSxNQUFNLEdBQVE7SUFDaEIsZ0JBQWdCLEVBQUU7UUFDZCxPQUFPLEVBQUUsQ0FBQztRQUNWLGVBQWUsQ0FBQyxFQUFlO1lBQzNCLE1BQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FDcEMsZUFBZSxFQUNmLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUNwQjtRQUNMLENBQUM7UUFDRCxPQUFPLENBQUMsS0FBZTtZQUNuQixPQUFPO2dCQUNHLEdBQUcsQ0FBQyxFQUFVOzt3QkFDaEIsTUFBTSxFQUFFLEdBQUcsTUFBTSxLQUFLLEVBQUUsQ0FBQzt3QkFDekIsTUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO3dCQUNuRSxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO3dCQUM3RCxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFOzRCQUNuQyxNQUFNLEdBQUcsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUNoQyxHQUFHLENBQUMsU0FBUyxHQUFHLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0NBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7NEJBQ3hCLENBQUM7NEJBQ0QsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLEtBQVUsRUFBRSxFQUFFO2dDQUN6QixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUM7Z0NBQ3hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7NEJBQ3ZCLENBQUM7d0JBQ0wsQ0FBQyxDQUFDO29CQUNOLENBQUM7aUJBQUE7Z0JBQ0ssR0FB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LENBQUMsQ0FBQztvQkFDaEIsQ0FBQztvQkFDRCxXQUFXLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUU7d0JBQzVCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDbEIsQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQyxDQUFDO1FBQ04sQ0FBQztLQUFBO0lBQ0QsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFDRCxTQUFlLHFCQUFxQjs7UUFDaEMsSUFBSSxTQUFTLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFO1lBQ2hELE1BQU0sVUFBVSxHQUFHLE1BQU0sU0FBUyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN2RCxPQUFPLFVBQVUsSUFBSSxDQUFDLE1BQU0sU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1NBQzVEO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztDQUFBIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkYkluZm86IGFueSA9IHtcclxuICAgIEluc3RhbGxhdGlvbkluZm86IHtcclxuICAgICAgICB2ZXJzaW9uOiAxLFxyXG4gICAgICAgIG9udXBncmFkZW5lZWRlZChkYjogSURCRGF0YWJhc2UpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShcclxuICAgICAgICAgICAgICAgIFwiaW5zdGFsbGF0aW9uc1wiLFxyXG4gICAgICAgICAgICAgICAgeyBrZXlQYXRoOiBcImlkXCIgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRob2RzKGdldERiOiBGdW5jdGlvbik6IFJlY29yZDxhbnksIEZ1bmN0aW9uPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhc3luYyBnZXQoaWQ6IG51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFtcImluc3RhbGxhdGlvbnNcIl0sIFwicmVhZHdyaXRlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJpbnN0YWxsYXRpb25zXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IG9iamVjdFN0b3JlLmdldChpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV2ZW50LCBpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYXN5bmMgcHV0KGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFtcImluc3RhbGxhdGlvbnNcIl0sIFwicmVhZHdyaXRlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJpbnN0YWxsYXRpb25zXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IG9iamVjdFN0b3JlLmFkZChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICByZXEub25jb21wbGV0ZSA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgSGlzdG9yeToge1xyXG4gICAgICAgIHZlcnNpb246IDIsXHJcbiAgICAgICAgb251cGdyYWRlbmVlZGVkKGRiOiBJREJEYXRhYmFzZSkge1xyXG4gICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ21lYXN1cmVtZW50SGlzdG9yeScpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFxyXG4gICAgICAgICAgICAgICAgICAgIFwibWVhc3VyZW1lbnRIaXN0b3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImluc3RhbGxhdGlvbklkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lYXN1cmVtZW50LmZyb21EYXRlVGltZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZWFzdXJlbWVudC50aWxsRGF0ZVRpbWVcIl1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChcImluc3RhbGxhdGlvbklkXCIsIFwiaW5zdGFsbGF0aW9uSWRcIiwgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0U3RvcmUuY3JlYXRlSW5kZXgoXCJmcm9tRGF0ZVRpbWVcIiwgXCJtZWFzdXJlbWVudC5mcm9tRGF0ZVRpbWVcIiwgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0U3RvcmUuY3JlYXRlSW5kZXgoXCJ0aWxsRGF0ZVRpbWVcIiwgXCJtZWFzdXJlbWVudC50aWxsRGF0ZVRpbWVcIiwgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucygnZm9yZWNhc3RIaXN0b3J5JykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoXHJcbiAgICAgICAgICAgICAgICAgICAgXCJmb3JlY2FzdEhpc3RvcnlcIixcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5zdGFsbGF0aW9uSWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJlZGljdGlvbkRhdGVUaW1lXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lYXN1cmVtZW50LmZyb21EYXRlVGltZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZWFzdXJlbWVudC50aWxsRGF0ZVRpbWVcIl1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChcImluc3RhbGxhdGlvbklkXCIsIFwiaW5zdGFsbGF0aW9uSWRcIik7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChcImZyb21EYXRlVGltZVwiLCBcIm1lYXN1cmVtZW50LmZyb21EYXRlVGltZVwiLCB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChcInRpbGxEYXRlVGltZVwiLCBcIm1lYXN1cmVtZW50LnRpbGxEYXRlVGltZVwiLCB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChcInByZWRpY3Rpb25EYXRlVGltZVwiLCBcInByZWRpY3Rpb25EYXRlVGltZVwiLCB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKCd1cGRhdGVzJykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImluc3RhbGxhdGlvbklkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZURhdGVUaW1lXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgb2JqZWN0U3RvcmUuY3JlYXRlSW5kZXgoXCJpbnN0YWxsYXRpb25JZFwiLCBcImluc3RhbGxhdGlvbklkXCIsIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlLmNyZWF0ZUluZGV4KFwidXBkYXRlRGF0ZVRpbWVcIiwgXCJ1cGRhdGVEYXRlVGltZVwiLCB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1ldGhvZHMoZ2V0RGI6IEZ1bmN0aW9uKTogUmVjb3JkPGFueSwgYW55PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBtZWFzdXJlbWVudDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIGdldChpbnN0YWxsYXRpb25JZDogbnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbXCJtZWFzdXJlbWVudEhpc3RvcnlcIl0sIFwicmVhZG9ubHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJtZWFzdXJlbWVudEhpc3RvcnlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmcm9tSW5kZXg6IElEQkluZGV4ID0gb2JqZWN0U3RvcmUuaW5kZXgoJ2luc3RhbGxhdGlvbklkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlSYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaW5zdGFsbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxID0gZnJvbUluZGV4LmdldEFsbChrZXlSYW5nZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25zdWNjZXNzID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlcS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uZXJyb3IgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV2ZW50LCBpbnN0YWxsYXRpb25JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIHB1dEFsbChkYXRhOiBhbnlbXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbXCJtZWFzdXJlbWVudEhpc3RvcnlcIl0sIFwicmVhZHdyaXRlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwibWVhc3VyZW1lbnRIaXN0b3J5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IGRhdGEubWFwKHJlY29yZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcTogSURCUmVxdWVzdCA9IG9iamVjdFN0b3JlLnB1dChyZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ21lYXN1cmVtZW50LnB1dEFsbCBlcnJvcicsIGV2ZW50LCByZWNvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZvcmVjYXN0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgZ2V0KGZyb21QcmVkaWN0aW9uRGF0ZVRpbWU6IGFueSwgdGlsbFByZWRpY3Rpb25EYXRlVGltZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbXCJmb3JlY2FzdEhpc3RvcnlcIl0sIFwicmVhZG9ubHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJmb3JlY2FzdEhpc3RvcnlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmcm9tSW5kZXg6IElEQkluZGV4ID0gb2JqZWN0U3RvcmUuaW5kZXgoJ3ByZWRpY3Rpb25EYXRlVGltZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5UmFuZ2UgPSBJREJLZXlSYW5nZS5ib3VuZChmcm9tUHJlZGljdGlvbkRhdGVUaW1lLCB0aWxsUHJlZGljdGlvbkRhdGVUaW1lKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxID0gZnJvbUluZGV4LmdldEFsbChrZXlSYW5nZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25zdWNjZXNzID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihldmVudCwgZnJvbVByZWRpY3Rpb25EYXRlVGltZSwgdGlsbFByZWRpY3Rpb25EYXRlVGltZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIHB1dEFsbChkYXRhOiBhbnlbXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW1wiZm9yZWNhc3RIaXN0b3J5XCJdLCBcInJlYWR3cml0ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmU6IElEQk9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJmb3JlY2FzdEhpc3RvcnlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gZGF0YS5tYXAocmVjb3JkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxOiBJREJSZXF1ZXN0ID0gb2JqZWN0U3RvcmUucHV0KHJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uc3VjY2VzcyA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihldmVudCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB1cGRhdGVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgZ2V0TW9zdFJlY2VudChpbnN0YWxsYXRpb25JZDogbnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbXCJ1cGRhdGVzXCJdLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwidXBkYXRlc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZyb21JbmRleDogSURCSW5kZXggPSBvYmplY3RTdG9yZS5pbmRleCgnaW5zdGFsbGF0aW9uSWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleVJhbmdlID0gSURCS2V5UmFuZ2Uub25seShpbnN0YWxsYXRpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IGZyb21JbmRleC5nZXRBbGwoa2V5UmFuZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uc3VjY2VzcyA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGhlTW9zdFJlY2VudCA9IHJlcS5yZXN1bHQucmVkdWNlKChtb3N0UmVjZW50LCBjdXJyZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3N0UmVjZW50LnVwZGF0ZURhdGVUaW1lIDwgY3VycmVudC51cGRhdGVEYXRlVGltZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9zdFJlY2VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZXEucmVzdWx0WzBdIHx8IHt9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhlTW9zdFJlY2VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uZXJyb3IgPSAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXZlbnQsIGluc3RhbGxhdGlvbklkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgcHV0KGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW1widXBkYXRlc1wiXSwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJ1cGRhdGVzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxOiBJREJSZXF1ZXN0ID0gb2JqZWN0U3RvcmUucHV0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uc3VjY2VzcyA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCd1cGRhdGVzLnB1dCBlcnJvcicsIGV2ZW50LCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgU2V0dGluZ3M6IHtcclxuICAgICAgICB2ZXJzaW9uOiAxLFxyXG4gICAgICAgIG9udXBncmFkZW5lZWRlZChkYjogSURCRGF0YWJhc2UpIHtcclxuICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKCdnbG9iYWwnKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShcclxuICAgICAgICAgICAgICAgICAgICBcImdsb2JhbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHsga2V5UGF0aDogXCJuYW1lXCIgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgb2JqZWN0U3RvcmUuY3JlYXRlSW5kZXgoXCJuYW1lXCIsIFwibmFtZVwiLCB7IHVuaXF1ZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlLmNyZWF0ZUluZGV4KFwidmFsdWVcIiwgXCJ2YWx1ZVwiLCB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRob2RzKGdldERiOiBGdW5jdGlvbik6IFJlY29yZDxhbnksIGFueT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZ2xvYmFsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgZ2V0KG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW1wiZ2xvYmFsXCJdLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwiZ2xvYmFsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJvbUluZGV4OiBJREJJbmRleCA9IG9iamVjdFN0b3JlLmluZGV4KCduYW1lJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlSYW5nZSA9IElEQktleVJhbmdlLm9ubHkobmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXEgPSBmcm9tSW5kZXguZ2V0KGtleVJhbmdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVxLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyBwdXQoc2V0dGluZzogeyBuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkgfSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW1wiZ2xvYmFsXCJdLCBcInJlYWR3cml0ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShcImdsb2JhbFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcTogSURCUmVxdWVzdCA9IG9iamVjdFN0b3JlLnB1dChzZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignbWVhc3VyZW1lbnQucHV0QWxsIGVycm9yJywgZXZlbnQsIHNldHRpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufTtcclxuZXhwb3J0IGZ1bmN0aW9uIGRiKG5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKHR5cGVvZiBkYkluZm9bbmFtZV0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgdGhyb3cgYEluZGV4ZWREQiAnJHtuYW1lfScgaXMgbm90IHN1cHBvcnRlZC5gO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmVyc2lvbiA9IGRiSW5mb1tuYW1lXS52ZXJzaW9uO1xyXG4gICAgYXN5bmMgZnVuY3Rpb24gZ2V0RGIoKTogUHJvbWlzZTxJREJEYXRhYmFzZT4ge1xyXG4gICAgICAgIGNvbnN0IHBlcnNpc3RlbnQgPSBhd2FpdCBlbnN1cmVEYXRhUGVyc2lzdGFuY2UoKTtcclxuICAgICAgICBjb25zb2xlLmRlYnVnKCdQRVJTSVNURU5UJywgcGVyc2lzdGVudCk7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdDogSURCT3BlbkRCUmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBldmVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoYEluZGV4ZWREQiBlcnJvcmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIGRiSW5mb1tuYW1lXS5vbnVwZ3JhZGVuZWVkZWQoZGIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb246IElEQlRyYW5zYWN0aW9uID0gZXZlbnQudGFyZ2V0LnRyYW5zYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ3VwZ3JhZGVkJylcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHJldHVybiBkYkluZm9bbmFtZV0ubWV0aG9kcyhnZXREYik7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZW5zdXJlRGF0YVBlcnNpc3RhbmNlKCkge1xyXG4gICAgaWYgKG5hdmlnYXRvci5zdG9yYWdlICYmIG5hdmlnYXRvci5zdG9yYWdlLnBlcnNpc3QpIHtcclxuICAgICAgICBjb25zdCBwZXJzaXN0ZW50ID0gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UucGVyc2lzdGVkKCk7XHJcbiAgICAgICAgcmV0dXJuIHBlcnNpc3RlbnQgfHwgKGF3YWl0IG5hdmlnYXRvci5zdG9yYWdlLnBlcnNpc3QoKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n')},3:function(module,__webpack_exports__,__webpack_require__){"use strict";eval("/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return AirlyPull; });\n/* harmony import */ var _Store__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\nconst urlCore = 'https://airapi.airly.eu/v2';\r\nfunction installationArgumentToQuery(endpoint, data) {\r\n    let url;\r\n    if (typeof data.id === 'number' || typeof data.id === 'string') {\r\n        url = `${data.id}`;\r\n    }\r\n    else if (typeof data.nearest === 'object') {\r\n        url = `nearest?lat=${data.nearest.latitude}&lng=${data.nearest.longitude}`;\r\n    }\r\n    return `${urlCore}/${endpoint[0]}${url}`;\r\n}\r\nfunction measurementArgumentToQuery(endpoint, data) {\r\n    let url;\r\n    if (typeof data.id === 'number' || typeof data.id === 'string') {\r\n        url = `installation?installationId=${data.id}`;\r\n    }\r\n    else if (typeof data.nearest === 'object') {\r\n        url = `nearest?lat=${data.nearest.latitude}&lng=${data.nearest.longitude}`;\r\n    }\r\n    else if (typeof data.forPoint === 'object') {\r\n        url = `point?lat=${data.forPoint.latitude}&lng=${data.forPoint.longitude}`;\r\n    }\r\n    return `${urlCore}/${endpoint[0]}${url}`;\r\n}\r\nfunction getApiKey() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const apiKey = yield _Store__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"a\"].Settings.setting('apiKey');\r\n        if (apiKey === null) {\r\n            throw 'No api key available in localStorage.';\r\n        }\r\n        return apiKey;\r\n    });\r\n}\r\nclass AirlyPull {\r\n    static installation(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let requestInit = {};\r\n            requestInit.headers = {\r\n                Accept: 'application/json',\r\n                apiKey: yield getApiKey()\r\n            };\r\n            const url = installationArgumentToQuery `installations/${data}`;\r\n            console.log(url);\r\n            const response = yield fetch(url, requestInit);\r\n            console.debug(response);\r\n            if (!response.ok) {\r\n                throw \"Response failed.\";\r\n            }\r\n            const json = yield response.json();\r\n            console.debug(json);\r\n            return json;\r\n        });\r\n    }\r\n    static measurements(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let requestInit = {};\r\n            requestInit.headers = {\r\n                Accept: 'application/json',\r\n                apiKey: yield getApiKey()\r\n            };\r\n            const url = measurementArgumentToQuery `measurements/${data}`;\r\n            const response = yield fetch(url, requestInit);\r\n            console.debug(response);\r\n            if (!response.ok) {\r\n                throw \"Response failed.\";\r\n            }\r\n            const json = yield response.json();\r\n            console.debug(json);\r\n            return json;\r\n        });\r\n    }\r\n}\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvYWlybHkvQWlybHlQdWxsLnRzP2Q4MjkiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUErQjtBQTZFL0IsTUFBTSxPQUFPLEdBQUcsNEJBQTRCLENBQUM7QUFDN0MsU0FBUywyQkFBMkIsQ0FBQyxRQUE4QixFQUFFLElBQTBCO0lBQzNGLElBQUksR0FBRyxDQUFDO0lBQ1IsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLEtBQUssUUFBUSxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUUsS0FBSyxRQUFRLEVBQUU7UUFDNUQsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0tBQ3RCO1NBQU0sSUFBSSxPQUFPLElBQUksQ0FBQyxPQUFPLEtBQUssUUFBUSxFQUFFO1FBQ3pDLEdBQUcsR0FBRyxlQUFlLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxRQUFRLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUM7S0FDOUU7SUFDRCxPQUFPLEdBQUcsT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQztBQUM3QyxDQUFDO0FBQ0QsU0FBUywwQkFBMEIsQ0FBQyxRQUE4QixFQUFFLElBQXlCO0lBQ3pGLElBQUksR0FBRyxDQUFDO0lBQ1IsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLEtBQUssUUFBUSxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUUsS0FBSyxRQUFRLEVBQUU7UUFDNUQsR0FBRyxHQUFHLCtCQUErQixJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7S0FDbEQ7U0FBTSxJQUFJLE9BQU8sSUFBSSxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUU7UUFDekMsR0FBRyxHQUFHLGVBQWUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLFFBQVEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztLQUM5RTtTQUFNLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRTtRQUMxQyxHQUFHLEdBQUcsYUFBYSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO0tBQzlFO0lBQ0QsT0FBTyxHQUFHLE9BQU8sSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7QUFDN0MsQ0FBQztBQUNELFNBQWUsU0FBUzs7UUFDcEIsTUFBTSxNQUFNLEdBQUcsTUFBTSxzREFBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEQsSUFBSSxNQUFNLEtBQUssSUFBSSxFQUFFO1lBQ2pCLE1BQU0sdUNBQXVDLENBQUM7U0FDakQ7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0NBQUE7QUFDTSxNQUFNLFNBQVM7SUFDbEIsTUFBTSxDQUFPLFlBQVksQ0FBQyxJQUEwQjs7WUFDaEQsSUFBSSxXQUFXLEdBQWdCLEVBQUUsQ0FBQztZQUNsQyxXQUFXLENBQUMsT0FBTyxHQUFHO2dCQUNsQixNQUFNLEVBQUUsa0JBQWtCO2dCQUMxQixNQUFNLEVBQUUsTUFBTSxTQUFTLEVBQUU7YUFDNUIsQ0FBQztZQUNGLE1BQU0sR0FBRyxHQUFHLDJCQUEyQixrQkFBaUIsSUFBSSxFQUFFLENBQUM7WUFDL0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7WUFFaEIsTUFBTSxRQUFRLEdBQUcsTUFBTSxLQUFLLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFO2dCQUNkLE1BQU0sa0JBQWtCLENBQUM7YUFDNUI7WUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNuQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztZQUNuQixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO0tBQUE7SUFDRCxNQUFNLENBQU8sWUFBWSxDQUFDLElBQTBCOztZQUNoRCxJQUFJLFdBQVcsR0FBZ0IsRUFBRSxDQUFDO1lBQ2xDLFdBQVcsQ0FBQyxPQUFPLEdBQUc7Z0JBQ2xCLE1BQU0sRUFBRSxrQkFBa0I7Z0JBQzFCLE1BQU0sRUFBRSxNQUFNLFNBQVMsRUFBRTthQUM1QixDQUFDO1lBQ0YsTUFBTSxHQUFHLEdBQUcsMEJBQTBCLGlCQUFnQixJQUFJLEVBQUUsQ0FBQztZQUU3RCxNQUFNLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDL0MsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2QsTUFBTSxrQkFBa0IsQ0FBQzthQUM1QjtZQUNELE1BQU0sSUFBSSxHQUFHLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ25DLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEIsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztLQUFBO0NBQ0oiLCJmaWxlIjoiMy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdG9yZSBmcm9tICcuLy4uL1N0b3JlJztcclxuZXhwb3J0IGludGVyZmFjZSBBaXJseUluc3RhbGxhdGlvbkluZm8ge1xyXG4gICAgXCJpZFwiOiBudW1iZXIsXHJcbiAgICBcImxvY2F0aW9uXCI6IHtcclxuICAgICAgICBcImxhdGl0dWRlXCI6IG51bWJlcixcclxuICAgICAgICBcImxvbmdpdHVkZVwiOiBudW1iZXJcclxuICAgIH0sXHJcbiAgICBcImFkZHJlc3NcIjoge1xyXG4gICAgICAgIFwiY291bnRyeVwiOiBzdHJpbmcsXHJcbiAgICAgICAgXCJjaXR5XCI6IHN0cmluZyxcclxuICAgICAgICBcInN0cmVldFwiOiBzdHJpbmcsXHJcbiAgICAgICAgXCJudW1iZXJcIjogc3RyaW5nLFxyXG4gICAgICAgIFwiZGlzcGxheUFkZHJlc3MxXCI6IHN0cmluZyxcclxuICAgICAgICBcImRpc3BsYXlBZGRyZXNzMlwiOiBzdHJpbmdcclxuICAgIH0sXHJcbiAgICBcImVsZXZhdGlvblwiOiBudW1iZXIsXHJcbiAgICBcImFpcmx5XCI6IGJvb2xlYW4sXHJcbiAgICBcInNwb25zb3JcIjoge1xyXG4gICAgICAgIFwibmFtZVwiOiBzdHJpbmcsXHJcbiAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBzdHJpbmcsXHJcbiAgICAgICAgXCJsb2dvXCI6IHN0cmluZyxcclxuICAgICAgICBcImxpbmtcIjogc3RyaW5nXHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBBaXJseU1lYXN1cmVtZW50SW5mbyB7XHJcbiAgICBcImZyb21EYXRlVGltZVwiOiBzdHJpbmcsXHJcbiAgICBcInRpbGxEYXRlVGltZVwiOiBzdHJpbmcsXHJcbiAgICBcInZhbHVlc1wiOiBbXHJcbiAgICAgICAgeyBcIm5hbWVcIjogXCJQTTFcIiwgXCJ2YWx1ZVwiOiBudW1iZXIgfSxcclxuICAgICAgICB7IFwibmFtZVwiOiBcIlBNMjVcIiwgXCJ2YWx1ZVwiOiBudW1iZXIgfSxcclxuICAgICAgICB7IFwibmFtZVwiOiBcIlBNMTBcIiwgXCJ2YWx1ZVwiOiBudW1iZXIgfSxcclxuICAgICAgICB7IFwibmFtZVwiOiBcIlBSRVNTVVJFXCIsIFwidmFsdWVcIjogbnVtYmVyIH0sXHJcbiAgICAgICAgeyBcIm5hbWVcIjogXCJIVU1JRElUWVwiLCBcInZhbHVlXCI6IG51bWJlciB9LFxyXG4gICAgICAgIHsgXCJuYW1lXCI6IFwiVEVNUEVSQVRVUkVcIiwgXCJ2YWx1ZVwiOiBudW1iZXIgfVxyXG4gICAgXSxcclxuICAgIFwiaW5kZXhlc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcIm5hbWVcIjogc3RyaW5nLFxyXG4gICAgICAgICAgICBcInZhbHVlXCI6IDM1LjUzLFxyXG4gICAgICAgICAgICBcImxldmVsXCI6IHN0cmluZyxcclxuICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIFwiYWR2aWNlXCI6IHN0cmluZyxcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBzdHJpbmdcclxuICAgICAgICB9XHJcbiAgICBdLFxyXG4gICAgXCJzdGFuZGFyZHNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJuYW1lXCI6IHN0cmluZyxcclxuICAgICAgICAgICAgXCJwb2xsdXRhbnRcIjogc3RyaW5nLFxyXG4gICAgICAgICAgICBcImxpbWl0XCI6IG51bWJlcixcclxuICAgICAgICAgICAgXCJwZXJjZW50XCI6IG51bWJlcixcclxuICAgICAgICB9XHJcbiAgICBdXHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBBaXJseU1lYXN1cmVtZW50c0luZm8ge1xyXG4gICAgXCJjdXJyZW50XCI6IEFpcmx5TWVhc3VyZW1lbnRJbmZvLFxyXG4gICAgXCJoaXN0b3J5XCI6IEFpcmx5TWVhc3VyZW1lbnRJbmZvW10sXHJcbiAgICBcImZvcmVjYXN0XCI6IEFpcmx5TWVhc3VyZW1lbnRJbmZvW11cclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIEluc3RhbGxhdGlvbkFyZ3VtZW50IHtcclxuICAgIGlkPzogbnVtYmVyIHwgc3RyaW5nLFxyXG4gICAgbmVhcmVzdD86IHtcclxuICAgICAgICBsYXRpdHVkZTogbnVtYmVyLFxyXG4gICAgICAgIGxvbmdpdHVkZTogbnVtYmVyXHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBNZWFzdXJlbWVudEFyZ3VtZW50IHtcclxuICAgIGlkPzogbnVtYmVyIHwgc3RyaW5nLFxyXG4gICAgbmVhcmVzdD86IHtcclxuICAgICAgICBsYXRpdHVkZTogbnVtYmVyLFxyXG4gICAgICAgIGxvbmdpdHVkZTogbnVtYmVyXHJcbiAgICB9LFxyXG4gICAgZm9yUG9pbnQ/OiB7XHJcbiAgICAgICAgbGF0aXR1ZGU6IG51bWJlcixcclxuICAgICAgICBsb25naXR1ZGU6IG51bWJlclxyXG4gICAgfVxyXG59XHJcbmNvbnN0IHVybENvcmUgPSAnaHR0cHM6Ly9haXJhcGkuYWlybHkuZXUvdjInO1xyXG5mdW5jdGlvbiBpbnN0YWxsYXRpb25Bcmd1bWVudFRvUXVlcnkoZW5kcG9pbnQ6IFRlbXBsYXRlU3RyaW5nc0FycmF5LCBkYXRhOiBJbnN0YWxsYXRpb25Bcmd1bWVudCkge1xyXG4gICAgbGV0IHVybDtcclxuICAgIGlmICh0eXBlb2YgZGF0YS5pZCA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGRhdGEuaWQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdXJsID0gYCR7ZGF0YS5pZH1gO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YS5uZWFyZXN0ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHVybCA9IGBuZWFyZXN0P2xhdD0ke2RhdGEubmVhcmVzdC5sYXRpdHVkZX0mbG5nPSR7ZGF0YS5uZWFyZXN0LmxvbmdpdHVkZX1gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGAke3VybENvcmV9LyR7ZW5kcG9pbnRbMF19JHt1cmx9YDtcclxufVxyXG5mdW5jdGlvbiBtZWFzdXJlbWVudEFyZ3VtZW50VG9RdWVyeShlbmRwb2ludDogVGVtcGxhdGVTdHJpbmdzQXJyYXksIGRhdGE6IE1lYXN1cmVtZW50QXJndW1lbnQpIHtcclxuICAgIGxldCB1cmw7XHJcbiAgICBpZiAodHlwZW9mIGRhdGEuaWQgPT09ICdudW1iZXInIHx8IHR5cGVvZiBkYXRhLmlkID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHVybCA9IGBpbnN0YWxsYXRpb24/aW5zdGFsbGF0aW9uSWQ9JHtkYXRhLmlkfWA7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhLm5lYXJlc3QgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgdXJsID0gYG5lYXJlc3Q/bGF0PSR7ZGF0YS5uZWFyZXN0LmxhdGl0dWRlfSZsbmc9JHtkYXRhLm5lYXJlc3QubG9uZ2l0dWRlfWA7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhLmZvclBvaW50ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHVybCA9IGBwb2ludD9sYXQ9JHtkYXRhLmZvclBvaW50LmxhdGl0dWRlfSZsbmc9JHtkYXRhLmZvclBvaW50LmxvbmdpdHVkZX1gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGAke3VybENvcmV9LyR7ZW5kcG9pbnRbMF19JHt1cmx9YDtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBnZXRBcGlLZXkoKSB7XHJcbiAgICBjb25zdCBhcGlLZXkgPSBhd2FpdCBTdG9yZS5TZXR0aW5ncy5zZXR0aW5nKCdhcGlLZXknKTtcclxuICAgIGlmIChhcGlLZXkgPT09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyAnTm8gYXBpIGtleSBhdmFpbGFibGUgaW4gbG9jYWxTdG9yYWdlLic7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXBpS2V5O1xyXG59XHJcbmV4cG9ydCBjbGFzcyBBaXJseVB1bGwge1xyXG4gICAgc3RhdGljIGFzeW5jIGluc3RhbGxhdGlvbihkYXRhOiBJbnN0YWxsYXRpb25Bcmd1bWVudCk6IFByb21pc2U8QWlybHlJbnN0YWxsYXRpb25JbmZvPiB7XHJcbiAgICAgICAgbGV0IHJlcXVlc3RJbml0OiBSZXF1ZXN0SW5pdCA9IHt9O1xyXG4gICAgICAgIHJlcXVlc3RJbml0LmhlYWRlcnMgPSB7XHJcbiAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICBhcGlLZXk6IGF3YWl0IGdldEFwaUtleSgpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCB1cmwgPSBpbnN0YWxsYXRpb25Bcmd1bWVudFRvUXVlcnlgaW5zdGFsbGF0aW9ucy8ke2RhdGF9YDtcclxuICAgICAgICBjb25zb2xlLmxvZyh1cmwpXHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCByZXF1ZXN0SW5pdCk7XHJcbiAgICAgICAgY29uc29sZS5kZWJ1ZyhyZXNwb25zZSlcclxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiUmVzcG9uc2UgZmFpbGVkLlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgIGNvbnNvbGUuZGVidWcoanNvbilcclxuICAgICAgICByZXR1cm4ganNvbjtcclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBtZWFzdXJlbWVudHMoZGF0YTogSW5zdGFsbGF0aW9uQXJndW1lbnQpOiBQcm9taXNlPEFpcmx5TWVhc3VyZW1lbnRzSW5mbz4ge1xyXG4gICAgICAgIGxldCByZXF1ZXN0SW5pdDogUmVxdWVzdEluaXQgPSB7fTtcclxuICAgICAgICByZXF1ZXN0SW5pdC5oZWFkZXJzID0ge1xyXG4gICAgICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgYXBpS2V5OiBhd2FpdCBnZXRBcGlLZXkoKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgdXJsID0gbWVhc3VyZW1lbnRBcmd1bWVudFRvUXVlcnlgbWVhc3VyZW1lbnRzLyR7ZGF0YX1gO1xyXG5cclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgcmVxdWVzdEluaXQpO1xyXG4gICAgICAgIGNvbnNvbGUuZGVidWcocmVzcG9uc2UpXHJcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICB0aHJvdyBcIlJlc3BvbnNlIGZhaWxlZC5cIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICBjb25zb2xlLmRlYnVnKGpzb24pO1xyXG4gICAgICAgIHJldHVybiBqc29uO1xyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///3\n")},33:function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./src/airly/AirlyMeasurementsGathering.ts\nvar AirlyMeasurementsGathering = __webpack_require__(6);\n\n// EXTERNAL MODULE: ./src/Store.ts\nvar Store = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/autoupdate.ts\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\nfunction autoupdateAllEnabled() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return yield Store[\"a\" /* default */].Settings.setting('autoupdateAll');\r\n    });\r\n}\r\nfunction autoupdateAll() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (yield autoupdateAllEnabled()) {\r\n            return yield updateInstallationsAll();\r\n        }\r\n        return false;\r\n    });\r\n}\r\nfunction updateInstallations(installations) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return yield Promise.all(installations.map(({ id }) => {\r\n            return Object(AirlyMeasurementsGathering[\"a\" /* updateMeasurements */])({ id });\r\n        }));\r\n    });\r\n}\r\nfunction updateInstallationsAll() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const installations = (yield Store[\"a\" /* default */].Settings.setting('installations')) || [];\r\n        return yield updateInstallations(installations);\r\n    });\r\n}\r\n\n// CONCATENATED MODULE: ./src/custom-service-worker.ts\nvar custom_service_worker_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\nconst CACHE_NAME = 'airly-collector-cache-v1';\r\nconst urlsToCache = [\r\n    '/',\r\n    '/dist/build.js'\r\n];\r\nself.addEventListener('install', (event) => custom_service_worker_awaiter(undefined, void 0, void 0, function* () {\r\n    console.debug(event);\r\n    event.waitUntil(caches.open(CACHE_NAME)\r\n        .then(cache => {\r\n        console.log('Opened cache');\r\n        return cache.addAll(urlsToCache);\r\n    }));\r\n}));\r\nself.addEventListener('fetch', (event) => {\r\n    event.respondWith(caches.match(event.request)\r\n        .then(response => {\r\n        if (response)\r\n            return response;\r\n        return fetch(event.request);\r\n    }));\r\n});\r\nself.addEventListener('activate', (event) => custom_service_worker_awaiter(undefined, void 0, void 0, function* () {\r\n    console.debug('activate', event);\r\n}));\r\nself.addEventListener('sync', (event) => {\r\n    console.debug('sync', event);\r\n    if (event.tag == 'autoupdateAllSync') {\r\n        event.waitUntil(updateAll());\r\n    }\r\n});\r\nself.addEventListener('message', function (event) {\r\n    console.log(\"SW Received Message: \" + event.data);\r\n});\r\nself.addEventListener('online', (event) => {\r\n    event.waitUntil(updateAll());\r\n});\r\nlet updateAllTimeout = null;\r\nfunction updateAll() {\r\n    return custom_service_worker_awaiter(this, void 0, void 0, function* () {\r\n        clearTimeout(updateAllTimeout);\r\n        yield autoupdateAll();\r\n        scheduleUpdateAll();\r\n        return;\r\n    });\r\n}\r\nfunction scheduleUpdateAll() {\r\n    clearTimeout(updateAllTimeout);\r\n    updateAllTimeout = setTimeout(updateAll, 60000);\r\n}\r\nupdateAll();\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvYXV0b3VwZGF0ZS50cz9hZjQ0Iiwid2VicGFjazovLy8uL3NyYy9jdXN0b20tc2VydmljZS13b3JrZXIudHM/YWUwNCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RTtBQUM1QztBQUVyQixTQUFlLG9CQUFvQjs7UUFDdEMsT0FBTyxNQUFNLHdCQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUN6RCxDQUFDO0NBQUE7QUFFTSxTQUFlLGFBQWE7O1FBQy9CLElBQUksTUFBTSxvQkFBb0IsRUFBRSxFQUFFO1lBQzlCLE9BQU8sTUFBTSxzQkFBc0IsRUFBRSxDQUFDO1NBQ3pDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztDQUFBO0FBRU0sU0FBZSxtQkFBbUIsQ0FBQyxhQUErQjs7UUFDckUsT0FBTyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUNsRCxPQUFPLGdFQUFrQixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FBQTtBQUVNLFNBQWUsc0JBQXNCOztRQUN4QyxNQUFNLGFBQWEsR0FBRyxPQUFNLHdCQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSSxFQUFFLENBQUM7UUFDMUUsT0FBTyxNQUFNLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7Q0FBQTs7Ozs7Ozs7Ozs7QUN2QjRDO0FBRTdDLE1BQU0sVUFBVSxHQUFHLDBCQUEwQixDQUFDO0FBQzlDLE1BQU0sV0FBVyxHQUFHO0lBQ2hCLEdBQUc7SUFDSCxnQkFBZ0I7Q0FDbkIsQ0FBQztBQUNGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsQ0FBTyxLQUFVLEVBQUUsRUFBRSxDQUFDLDhCQUFEO0lBQ2xELE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckIsS0FBSyxDQUFDLFNBQVMsQ0FDWCxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVCLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUMsQ0FDVDtBQUNMLENBQUMsRUFBQyxDQUFDO0FBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO0lBQzFDLEtBQUssQ0FBQyxXQUFXLENBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1NBQ3RCLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUNiLElBQUksUUFBUTtZQUNSLE9BQU8sUUFBUSxDQUFDO1FBQ3BCLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7SUFDL0IsQ0FBQyxDQUFDLENBQ1Q7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsQ0FBTSxLQUFLLEVBQUMsRUFBRSxDQUFDLDhCQUFEO0lBQzVDLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3JDLENBQUMsRUFBQztBQUVGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFVLEVBQUUsRUFBRTtJQUN6QyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM3QixJQUFJLEtBQUssQ0FBQyxHQUFHLElBQUksbUJBQW1CLEVBQUU7UUFDbEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztLQUMvQjtBQUNMLENBQUMsQ0FBQztBQUVGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsVUFBVSxLQUFVO0lBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RELENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO0lBQzNDLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUM7QUFFaEMsQ0FBQyxDQUFDO0FBRUYsSUFBSSxnQkFBZ0IsR0FBUSxJQUFJLENBQUM7QUFFakMsU0FBZSxTQUFTOztRQUNwQixZQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUMvQixNQUFNLGFBQWEsRUFBRSxDQUFDO1FBQ3RCLGlCQUFpQixFQUFFLENBQUM7UUFDcEIsT0FBTztJQUNYLENBQUM7Q0FBQTtBQUVELFNBQVMsaUJBQWlCO0lBQ3RCLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9CLGdCQUFnQixHQUFHLFVBQVUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDcEQsQ0FBQztBQUVELFNBQVMsRUFBRSxDQUFDIiwiZmlsZSI6IjMzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXBkYXRlTWVhc3VyZW1lbnRzIH0gZnJvbSAnLi9haXJseS9BaXJseU1lYXN1cmVtZW50c0dhdGhlcmluZyc7XHJcbmltcG9ydCBTdG9yZSBmcm9tICcuL1N0b3JlJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRvdXBkYXRlQWxsRW5hYmxlZCgpIHtcclxuICAgIHJldHVybiBhd2FpdCBTdG9yZS5TZXR0aW5ncy5zZXR0aW5nKCdhdXRvdXBkYXRlQWxsJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRvdXBkYXRlQWxsKCkge1xyXG4gICAgaWYgKGF3YWl0IGF1dG91cGRhdGVBbGxFbmFibGVkKCkpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdXBkYXRlSW5zdGFsbGF0aW9uc0FsbCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlSW5zdGFsbGF0aW9ucyhpbnN0YWxsYXRpb25zOiB7IGlkOiBudW1iZXIgfVtdKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoaW5zdGFsbGF0aW9ucy5tYXAoKHsgaWQgfSkgPT4ge1xyXG4gICAgICAgIHJldHVybiB1cGRhdGVNZWFzdXJlbWVudHMoeyBpZCB9KTtcclxuICAgIH0pKVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlSW5zdGFsbGF0aW9uc0FsbCgpIHtcclxuICAgIGNvbnN0IGluc3RhbGxhdGlvbnMgPSBhd2FpdCBTdG9yZS5TZXR0aW5ncy5zZXR0aW5nKCdpbnN0YWxsYXRpb25zJykgfHwgW107XHJcbiAgICByZXR1cm4gYXdhaXQgdXBkYXRlSW5zdGFsbGF0aW9ucyhpbnN0YWxsYXRpb25zKTtcclxufVxyXG4iLCJpbXBvcnQgeyBhdXRvdXBkYXRlQWxsIH0gZnJvbSAnLi9hdXRvdXBkYXRlJztcclxuXHJcbmNvbnN0IENBQ0hFX05BTUUgPSAnYWlybHktY29sbGVjdG9yLWNhY2hlLXYxJztcclxuY29uc3QgdXJsc1RvQ2FjaGUgPSBbXHJcbiAgICAnLycsXHJcbiAgICAnL2Rpc3QvYnVpbGQuanMnXHJcbl07XHJcbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGFzeW5jIChldmVudDogYW55KSA9PiB7XHJcbiAgICBjb25zb2xlLmRlYnVnKGV2ZW50KTtcclxuICAgIGV2ZW50LndhaXRVbnRpbChcclxuICAgICAgICBjYWNoZXMub3BlbihDQUNIRV9OQU1FKVxyXG4gICAgICAgICAgICAudGhlbihjYWNoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT3BlbmVkIGNhY2hlJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKHVybHNUb0NhY2hlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgIClcclxufSk7XHJcbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgZXZlbnQucmVzcG9uZFdpdGgoXHJcbiAgICAgICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2goZXZlbnQucmVxdWVzdClcclxuICAgICAgICAgICAgfSlcclxuICAgIClcclxufSk7XHJcblxyXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgYXN5bmMgZXZlbnQgPT4ge1xyXG4gICAgY29uc29sZS5kZWJ1ZygnYWN0aXZhdGUnLCBldmVudCk7XHJcbn0pXHJcblxyXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ3N5bmMnLCAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgY29uc29sZS5kZWJ1Zygnc3luYycsIGV2ZW50KTtcclxuICAgIGlmIChldmVudC50YWcgPT0gJ2F1dG91cGRhdGVBbGxTeW5jJykge1xyXG4gICAgICAgIGV2ZW50LndhaXRVbnRpbCh1cGRhdGVBbGwoKSlcclxuICAgIH1cclxufSlcclxuXHJcbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudDogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlNXIFJlY2VpdmVkIE1lc3NhZ2U6IFwiICsgZXZlbnQuZGF0YSk7XHJcbn0pO1xyXG5cclxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgZXZlbnQud2FpdFVudGlsKHVwZGF0ZUFsbCgpKVxyXG5cclxufSlcclxuXHJcbmxldCB1cGRhdGVBbGxUaW1lb3V0OiBhbnkgPSBudWxsO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWxsKCkge1xyXG4gICAgY2xlYXJUaW1lb3V0KHVwZGF0ZUFsbFRpbWVvdXQpO1xyXG4gICAgYXdhaXQgYXV0b3VwZGF0ZUFsbCgpO1xyXG4gICAgc2NoZWR1bGVVcGRhdGVBbGwoKTtcclxuICAgIHJldHVybjtcclxufVxyXG5cclxuZnVuY3Rpb24gc2NoZWR1bGVVcGRhdGVBbGwoKSB7XHJcbiAgICBjbGVhclRpbWVvdXQodXBkYXRlQWxsVGltZW91dCk7XHJcbiAgICB1cGRhdGVBbGxUaW1lb3V0ID0gc2V0VGltZW91dCh1cGRhdGVBbGwsIDYwMDAwKTtcclxufVxyXG5cclxudXBkYXRlQWxsKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///33\n")},6:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return updateMeasurements; });\n/* harmony import */ var _AirlyPull__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3);\n/* harmony import */ var _Store__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n/* harmony import */ var _IndexedDB__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(1);\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\n\r\nfunction updateMeasurements(data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const installationInfo = yield _Store__WEBPACK_IMPORTED_MODULE_1__[/* default */ "a"].Airly.installation(data);\r\n        const id = installationInfo.id;\r\n        const measurements = yield _AirlyPull__WEBPACK_IMPORTED_MODULE_0__[/* AirlyPull */ "a"].measurements(data);\r\n        const currentTime = new Date().toISOString();\r\n        return yield Promise.all([\r\n            storeHistory(id, measurements.history),\r\n            storeForecast(id, measurements.forecast, currentTime),\r\n            storeUpdateTime(id, currentTime),\r\n        ]);\r\n    });\r\n}\r\nfunction storeHistory(installationId, data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const records = data.map(measurement => ({\r\n            installationId,\r\n            measurement\r\n        }));\r\n        return Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_2__[/* db */ "a"])(\'History\').measurement.putAll(records);\r\n    });\r\n}\r\nfunction storeForecast(installationId, data, currentTime = new Date().toISOString()) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const records = data.map(measurement => ({\r\n            installationId,\r\n            predictionDateTime: currentTime,\r\n            measurement\r\n        }));\r\n        return Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_2__[/* db */ "a"])(\'History\').forecast.putAll(records);\r\n    });\r\n}\r\nfunction storeUpdateTime(installationId, updateDateTime = new Date().toISOString()) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const record = {\r\n            installationId,\r\n            updateDateTime\r\n        };\r\n        return Object(_IndexedDB__WEBPACK_IMPORTED_MODULE_2__[/* db */ "a"])(\'History\').updates.put(record);\r\n    });\r\n}\r\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvYWlybHkvQWlybHlNZWFzdXJlbWVudHNHYXRoZXJpbmcudHM/ODQ5ZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBb0Y7QUFDdkQ7QUFDTztBQUU3QixTQUFlLGtCQUFrQixDQUFDLElBQTBCOztRQUMvRCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sc0RBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlELE1BQU0sRUFBRSxHQUFHLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztRQUMvQixNQUFNLFlBQVksR0FBRyxNQUFNLDREQUFTLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hELE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDN0MsT0FBTyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7WUFDckIsWUFBWSxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsT0FBTyxDQUFDO1lBQ3RDLGFBQWEsQ0FBQyxFQUFFLEVBQUUsWUFBWSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUM7WUFDckQsZUFBZSxDQUFDLEVBQUUsRUFBRSxXQUFXLENBQUM7U0FDbkMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUFBO0FBQ0QsU0FBZSxZQUFZLENBQUMsY0FBc0IsRUFBRSxJQUE0Qjs7UUFDNUUsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDckMsY0FBYztZQUNkLFdBQVc7U0FDZCxDQUFDLENBQUM7UUFDSCxPQUFPLDZEQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNyRCxDQUFDO0NBQUE7QUFDRCxTQUFlLGFBQWEsQ0FBQyxjQUFzQixFQUFFLElBQTRCLEVBQUUsV0FBVyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFOztRQUNySCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNyQyxjQUFjO1lBQ2Qsa0JBQWtCLEVBQUUsV0FBVztZQUMvQixXQUFXO1NBQ2QsQ0FBQyxDQUFDLENBQUM7UUFDSixPQUFPLDZEQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsRCxDQUFDO0NBQUE7QUFDRCxTQUFlLGVBQWUsQ0FBQyxjQUFzQixFQUFFLGNBQWMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTs7UUFDNUYsTUFBTSxNQUFNLEdBQUc7WUFDWCxjQUFjO1lBQ2QsY0FBYztTQUNqQjtRQUNELE9BQU8sNkRBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLENBQUM7Q0FBQSIsImZpbGUiOiI2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWlybHlQdWxsLCBJbnN0YWxsYXRpb25Bcmd1bWVudCwgQWlybHlNZWFzdXJlbWVudEluZm8gfSBmcm9tICcuL0Fpcmx5UHVsbCc7XHJcbmltcG9ydCBTdG9yZSBmcm9tICcuLi9TdG9yZSc7XHJcbmltcG9ydCB7IGRiIH0gZnJvbSBcIi4vLi4vSW5kZXhlZERCXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTWVhc3VyZW1lbnRzKGRhdGE6IEluc3RhbGxhdGlvbkFyZ3VtZW50KSB7XHJcbiAgICBjb25zdCBpbnN0YWxsYXRpb25JbmZvID0gYXdhaXQgU3RvcmUuQWlybHkuaW5zdGFsbGF0aW9uKGRhdGEpO1xyXG4gICAgY29uc3QgaWQgPSBpbnN0YWxsYXRpb25JbmZvLmlkO1xyXG4gICAgY29uc3QgbWVhc3VyZW1lbnRzID0gYXdhaXQgQWlybHlQdWxsLm1lYXN1cmVtZW50cyhkYXRhKTtcclxuICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICBzdG9yZUhpc3RvcnkoaWQsIG1lYXN1cmVtZW50cy5oaXN0b3J5KSxcclxuICAgICAgICBzdG9yZUZvcmVjYXN0KGlkLCBtZWFzdXJlbWVudHMuZm9yZWNhc3QsIGN1cnJlbnRUaW1lKSxcclxuICAgICAgICBzdG9yZVVwZGF0ZVRpbWUoaWQsIGN1cnJlbnRUaW1lKSxcclxuICAgIF0pO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHN0b3JlSGlzdG9yeShpbnN0YWxsYXRpb25JZDogbnVtYmVyLCBkYXRhOiBBaXJseU1lYXN1cmVtZW50SW5mb1tdKSB7XHJcbiAgICBjb25zdCByZWNvcmRzID0gZGF0YS5tYXAobWVhc3VyZW1lbnQgPT4gKHtcclxuICAgICAgICBpbnN0YWxsYXRpb25JZCxcclxuICAgICAgICBtZWFzdXJlbWVudFxyXG4gICAgfSkpXHJcbiAgICByZXR1cm4gZGIoJ0hpc3RvcnknKS5tZWFzdXJlbWVudC5wdXRBbGwocmVjb3Jkcyk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gc3RvcmVGb3JlY2FzdChpbnN0YWxsYXRpb25JZDogbnVtYmVyLCBkYXRhOiBBaXJseU1lYXN1cmVtZW50SW5mb1tdLCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSkge1xyXG4gICAgY29uc3QgcmVjb3JkcyA9IGRhdGEubWFwKG1lYXN1cmVtZW50ID0+ICh7XHJcbiAgICAgICAgaW5zdGFsbGF0aW9uSWQsXHJcbiAgICAgICAgcHJlZGljdGlvbkRhdGVUaW1lOiBjdXJyZW50VGltZSxcclxuICAgICAgICBtZWFzdXJlbWVudFxyXG4gICAgfSkpO1xyXG4gICAgcmV0dXJuIGRiKCdIaXN0b3J5JykuZm9yZWNhc3QucHV0QWxsKHJlY29yZHMpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHN0b3JlVXBkYXRlVGltZShpbnN0YWxsYXRpb25JZDogbnVtYmVyLCB1cGRhdGVEYXRlVGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSkge1xyXG4gICAgY29uc3QgcmVjb3JkID0ge1xyXG4gICAgICAgIGluc3RhbGxhdGlvbklkLFxyXG4gICAgICAgIHVwZGF0ZURhdGVUaW1lXHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGIoJ0hpc3RvcnknKS51cGRhdGVzLnB1dChyZWNvcmQpO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///6\n')}});